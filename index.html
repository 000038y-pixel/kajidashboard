<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>家事ダッシュボード</title>

<style>
body {
font-family: -apple-system, BlinkMacSystemFont, sans-serif;
background: #f2f2f7;
margin: 0;
padding: 12px;
}

h1 {
font-size: 18px;
}

h2 {
font-size: 14px;
margin-top: 16px;
color: #555;
}

/* ===== グリッド：iPhone優先 ===== */
.grid {
display: grid;
grid-template-columns: repeat(4, 1fr);
gap: 8px;
}

/* ===== 家事アイコン ===== */
.chore {
background: #ffffff;
border-radius: 8px;
padding: 6px 4px;
text-align: center;
box-shadow: 0 1px 2px rgba(0,0,0,0.1);
user-select: none;
font-size: 11px;
line-height: 1.2;
}

/* 期限内 */
.chore.done {
background: #1c1c1e;
color: #fff;
}

/* 期限切れ7日以上 */
.chore.overdue {
background: #ff3b30;
color: #fff;
}

.chore .name {
font-weight: 500;
margin-bottom: 2px;
word-break: break-word;
}

.chore .date {
font-size: 10px;
opacity: 0.8;
}

/* ===== 追加ボタン（控えめ） ===== */
.add-button {
margin: 16px 0;
padding: 8px;
text-align: center;
background: #e5e5ea;
color: #555;
border-radius: 8px;
font-size: 12px;
}
</style>
</head>

<body>

<h1>家事ダッシュボード</h1>

<div id="app"></div>

<div class="add-button" onclick="addChore()">＋ 家事を追加</div>

<script>
const groups = [
{ title: "7日以内に実施", days: 7 },
{ title: "1ヶ月以内に実施", days: 30 },
{ title: "3ヶ月以内に実施", days: 90 }
];

let chores = JSON.parse(localStorage.getItem("chores")) || [];

/* ===== 状態判定 ===== */
function getStatus(chore) {
if (!chore.lastDone) return "none";

const last = new Date(chore.lastDone);
const now = new Date();

const limit = new Date(last);
limit.setDate(limit.getDate() + groups[chore.group].days);

if (now <= limit) return "done";

const overdueDays = Math.floor((now - limit) / (1000 * 60 * 60 * 24));
if (overdueDays >= 7) return "overdue";

return "none";
}

function formatDate(dateString) {
if (!dateString) return "未実施";
const d = new Date(dateString);
return String(d.getMonth() + 1).padStart(2, "0") + "/" +
String(d.getDate()).padStart(2, "0");
}

/* ===== 描画 ===== */
function render() {
const app = document.getElementById("app");
app.innerHTML = "";

groups.forEach((group, gIndex) => {
const h2 = document.createElement("h2");
h2.textContent = group.title;
app.appendChild(h2);

const grid = document.createElement("div");
grid.className = "grid";

chores.forEach((chore, cIndex) => {
if (chore.group === gIndex) {
const status = getStatus(chore);
const div = document.createElement("div");

div.className = "chore";
if (status === "done") div.classList.add("done");
if (status === "overdue") div.classList.add("overdue");

div.innerHTML = `
<div class="name">${chore.name}</div>
<div class="date">${formatDate(chore.lastDone)}</div>
`;

div.onclick = () => {
chore.lastDone = new Date().toISOString();
save();
};

div.oncontextmenu = (e) => {
e.preventDefault();
if (confirm("この家事を削除しますか？")) {
chores.splice(cIndex, 1);
save();
}
};

grid.appendChild(div);
}
});

app.appendChild(grid);
});
}

/* ===== 追加 ===== */
function addChore() {
const name = prompt("家事の名前を入力してください");
if (!name) return;

const group = prompt(
"グループ番号を入力してください\n0: 7日以内\n1: 1ヶ月以内\n2: 3ヶ月以内"
);

if (!["0","1","2"].includes(group)) return;

chores.push({
name: name,
group: Number(group),
lastDone: null
});

save();
}

function save() {
localStorage.setItem("chores", JSON.stringify(chores));
render();
}

render();
</script>

</body>
</html>
